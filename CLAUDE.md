# PyRHEED 项目配置

## 项目概述

PyRHEED 是一个用于反射高能电子衍射 (RHEED) 数据分析和模拟的 Python 应用。当前目标是添加**摄像头实时采集**功能。

## RHEED 原理 (领域知识)

### 基本概念

**RHEED = 反射高能电子衍射** (Reflection High Energy Electron Diffraction)

用于分析材料**表面**晶体结构的技术，主要在**分子束外延 (MBE)** 设备中进行原位实时监测。

### 工作原理

```
电子枪 ──→ 高能电子束 (20-50 keV)
              ↘ (掠射角 1-3°)
               ↘
════════════════●════════════════  样品表面
                ↗ ↗ ↗
             衍射电子
                ↓
          ┌──────────┐
          │ 荧光屏/CCD │ → 衍射花样
          └──────────┘
```

### 关键参数

| 参数 | 值 | 说明 |
|------|-----|------|
| 电子能量 | 20-50 keV | 高能电子 |
| 电子波长 | ~10⁻³ nm | 比 X 射线更短 |
| 晶面间距 | ~10⁻¹ nm | 典型晶体 |
| 衍射角 | < 1° | 非常小 (因为 λ << d) |
| 穿透深度 | 几纳米 | 只探测表面前几层原子 |

### 布拉格定律

```
nλ = 2d·sin(θ)

n = 衍射级数 (通常取 1)
λ = 电子波长 (~0.01 nm)
d = 晶面间距 (~0.1 nm)
θ = 衍射角
```

### 爱瓦尔德球 (Ewald Sphere)

- 薄样品的倒易点阵沿厚度方向**延伸成杆状**
- 电子波长短 → 爱瓦尔德球半径大 → 球面近似为平面
- 杆与球相交处产生衍射，略偏离布拉格条件也能产生衍射

### 衍射花样解读

| 花样类型 | 表面状态 | 说明 |
|----------|----------|------|
| **条纹状 (杆状)** | 平整单晶 | 理想状态，表面洁净平整 |
| **点状** | 三维岛状生长 | 多个平面衍射叠加 (面外衍射) |
| **环状** | 多晶 | 多个晶粒取向随机 |

### 主要应用

1. **生长速率监控**
   - 衍射强度振荡，一个周期 = 一个原子层
   - 实现原子级精度的膜厚控制

2. **表面形貌分析**
   - 判断层状生长 vs 岛状生长
   - 对表面粗糙度敏感 (亚纳米级)

3. **温度校正**
   - 通过观察表面重构校正衬底温度

### RHEED vs LEED

| 特性 | RHEED (高能) | LEED (低能) |
|------|-------------|-------------|
| 电子能量 | 20-50 keV | 20-500 eV |
| 入射角度 | 掠射 (1-3°) | 垂直入射 |
| 监测方式 | 原位实时 | 生长后分析 |
| 反射方向 | 向前 | 向后 (回发射端) |

### 对软件开发的影响

- **图像特征**: 条纹/点状/环状花样
- **强度分析**: 需要沿条纹方向提取强度曲线
- **振荡分析**: 监测强度随时间的周期性变化
- **实时性要求**: 摄像头采集需要足够帧率捕捉振荡

## 技术栈

- **语言**: Python 3.12+
- **GUI框架**: PyQt6
- **图像处理**: NumPy, PIL, rawpy
- **科学计算**: SciPy, scikit-learn
- **晶体学**: pymatgen

## 项目结构

```
src/pyrheed/
├── __main__.py          # 入口点
├── window.py            # 主窗口 (核心)
├── canvas.py            # 图像画布 (核心)
├── process.py           # 图像处理 (核心)
├── profile_chart.py     # 剖面图表
├── configuration/       # 配置文件
└── data/                # 图标和资源
```

## 开发命令

```bash
# 安装依赖
pip install -e .

# 运行应用
python -m pyrheed

# 运行测试
pytest tests/

# 类型检查
mypy src/pyrheed/
```

## 当前开发任务

### 摄像头支持 (feature/camera-support)

**目标**: 添加实时摄像头采集功能，支持视频流分析

**核心改动文件**:
- `src/pyrheed/camera/` - 新增摄像头模块
- `src/pyrheed/window.py` - 添加摄像头 UI
- `src/pyrheed/process.py` - 抽象帧处理接口

**新增依赖**:
- opencv-python >= 4.9.0

## Claude 开发规范

### 代码风格
- 使用类型注解
- 遵循 PEP 8
- PyQt6 信号/槽命名使用大写 (如 `FRAME_READY`)
- 私有属性使用下划线前缀 (如 `_running`)

### 测试要求
- 新功能必须有单元测试
- GUI 组件使用 pytest-qt 测试
- 目标覆盖率 >= 80%

### Git 规范
- 分支: `feature/camera-support`
- 提交信息: 中文或英文均可，使用 conventional commits

## 注意事项

- 保持与现有代码风格一致
- 不破坏现有功能
- 摄像头模块应独立，易于禁用
- 考虑跨平台兼容性 (Windows/macOS/Linux)
